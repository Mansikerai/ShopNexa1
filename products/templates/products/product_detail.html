<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ product.name }} | ShopNexa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">ShopNexa</a>

        <form method="GET" action="/" class="d-flex me-3">
    <input 
        type="text" 
        name="q" 
        class="form-control form-control-sm" 
        placeholder="Search products..."
        value="{{ query|default:'' }}"
    >
    <button class="btn btn-outline-dark btn-sm ms-2">
        üîç
    </button>
</form>


        <div class="ms-auto d-flex align-items-center gap-3">

            <a href="{% url 'wishlist' %}" class="btn btn-outline-danger btn-sm">
                ‚ù§Ô∏è Wishlist
            </a>

            <a href="{% url 'cart_detail' %}" class="btn btn-outline-dark btn-sm">
                üõí Cart
            </a>

            {% if user.is_authenticated %}
                
                <div class="dropdown">
                    <button class="btn btn-outline-primary btn-sm dropdown-toggle"
                            type="button"
                            data-bs-toggle="dropdown">
                        üë§ {{ request.user.username }}
                    </button>

                <ul class="dropdown-menu dropdown-menu-end">
                <li>
                    <a class="dropdown-item" href="{% url 'profile' %}">
                        My Profile
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="{% url 'my_orders' %}">
                        My Orders
                    </a>
                </li>

                <li><hr class="dropdown-divider"></li>

                <li>
                <a class="dropdown-item text-danger" href="{% url 'logout' %}">
                    Logout
                </a>
                </li>
                </ul>


                </div>
            {% else %}
                <a href="{% url 'login' %}" class="btn btn-outline-dark btn-sm">
                    Login
                </a>
            {% endif %}
        </div>
    </div>
</nav>


<div class="container mt-5">
    <div class="row">

        <div class="col-md-6">
            <img src="{{ product.image.url }}" class="img-fluid rounded shadow">
        </div>

        <div class="col-md-6">
            <h2>{{ product.name }}</h2>
            <p class="text-muted">{{ product.category.name }}</p>
            <h4 class="fw-bold">‚Çπ {{ product.price }}</h4>

            <h5 class="mt-4">Product Details</h5>
            <p style="line-height: 1.8;">{{ product.description }}</p>

            <div class="d-flex gap-2 mt-4">

            {% if user.is_authenticated %}

    
            {% if product.stock > 0 %}
                <a href="{% url 'cart_add' product.id %}" class="btn btn-dark">
                    Add to Cart
                </a>
            {% else %}
                <button class="btn btn-secondary" disabled>
                    Out of Stock
                </button>
            {% endif %}

    
            <button
                type="button"
                class="btn btn-danger"
             onclick="addToWishlist({{ product.id }})">
                ‚ù§Ô∏è Add to Wishlist
            </button>

        <p id="wishlist-msg" class="text-success mt-2" style="display:none;">
            ‚úî Added to wishlist
        </p>


            {% else %}

            <a href="{% url 'login' %}?next={{ request.path }}"
            class="btn btn-dark">
                Login to Add to Cart
            </a>

            <a href="{% url 'login' %}?next={{ request.path }}"
                class="btn btn-outline-danger">
                ‚ù§Ô∏è Login to Wishlist
            </a>

{% endif %}


            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
function addToWishlist(productId) {
    fetch(`/wishlist/add/${productId}/`, {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            document.getElementById("wishlist-msg").style.display = "block";
        }
    });
}
</script>


<footer class="bg-dark text-white text-center py-3 mt-5">
    ¬© 2025 ShopNexa | Furniture & Home D√©cor
</footer>
</body>
</html>
